strategy:
  matrix:
    configuration: [Release, Debug]

steps:
- name: Checkout repository
  uses: actions/checkout@v4

- name: Setup .NET
  uses: actions/setup-dotnet@v4
  with:
    dotnet-version: '8.0.x'

- name: Restore dependencies
  run: dotnet restore

- name: Build
  run: dotnet build --configuration ${{ matrix.configuration }} --no-restore

- name: Publish (win-x64)
  run: |
    dotnet publish --configuration ${{ matrix.configuration }} `
      --runtime win-x64 `
      --self-contained true `
      --output ./publish/win-x64 `
      -p:PublishSingleFile=true

- name: Publish (win-x86)
  run: |
    dotnet publish --configuration ${{ matrix.configuration }} `
      --runtime win-x86 `
      --self-contained true `
      --output ./publish/win-x86 `
      -p:PublishSingleFile=true

- name: Create archives
  run: |
    Compress-Archive -Path ./publish/win-x64/* -DestinationPath Snaffler-${{ matrix.configuration }}-win-x64.zip
    Compress-Archive -Path ./publish/win-x86/* -DestinationPath Snaffler-${{ matrix.configuration }}-win-x86.zip

- name: Upload x64 artifact
  uses: actions/upload-artifact@v4
  with:
    name: Snaffler-${{ matrix.configuration }}-win-x64
    path: Snaffler-${{ matrix.configuration }}-win-x64.zip

- name: Upload x86 artifact
  uses: actions/upload-artifact@v4
  with:
    name: Snaffler-${{ matrix.configuration }}-win-x86
    path: Snaffler-${{ matrix.configuration }}-win-x86.zip
